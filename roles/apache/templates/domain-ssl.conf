<VirtualHost *:443>
  ServerName {{ domain }}
{% for alias in domain_site_aliases %}
  ServerAlias {{ alias }}
{% endfor %}
  
  DocumentRoot /var/apache2/{{ domain }}/www/
  <Directory /var/apache2/{{ domain }}/www/>
    Require all granted
  </Directory>
  
  LogLevel warn
  ErrorLog /var/apache2/{{ domain }}/logs/error_log
  TransferLog /var/apache2/{{ domain }}/logs/access_log
  
  ServerAdmin {{ domain_webmaster }}
  
  Options FollowSymLinks
  
  # Configure SSL for this virtual host (derived from /etc/apache2/sites-available/default-ssl)
  SSLEngine on
  SSLCertificateFile /var/lib/acme/live/{{ domain }}/cert
  SSLCertificateKeyFile /var/lib/acme/live/{{ domain }}/privkey 
  SSLCertificateChainFile /var/lib/acme/live/{{ domain }}/chain
  SSLCACertificateFile /etc/ssl/certs/ca-certificates.crt
  <FilesMatch "\.(cgi|shtml|phtml|php)$">
    SSLOptions +StdEnvVars
  </FilesMatch>
  <Directory /usr/lib/cgi-bin>
    SSLOptions +StdEnvVars
  </Directory>
  BrowserMatch "MSIE [2-6]" \
    nokeepalive ssl-unclean-shutdown \
    downgrade-1.0 force-response-1.0
  # MSIE 7 and newer should be able to use keepalive
  BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown
  
  # Disable SSL v2 and v3 to prevent POODLE attacks.
  SSLProtocol all -SSLv2 -SSLv3
</VirtualHost>

